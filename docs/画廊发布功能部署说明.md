# 画廊发布功能部署说明

## 功能概述

用户生成图片后，可以将图片发布到公共画廊，供其他用户浏览。

## 数据库配置

### 1. 创建 images 集合

在微信开发者工具的云开发控制台中：

1. 打开「云开发」-> 「数据库」
2. 创建集合：`images`
3. 设置权限：
   - 读权限：所有用户可读
   - 写权限：仅创建者可写

### 2. 数据结构

```javascript
{
  "_id": "记录ID",
  "openid": "用户openid",
  "imageUrl": "图片URL",
  "prompt": "正向提示词",
  "negativePrompt": "反向提示词",
  "taskId": "生成任务ID",
  "createTime": "创建时间",
  "isPublic": true,  // 是否公开
  "likes": 0,        // 点赞数
  "views": 0,        // 浏览数
  "status": "published" // 状态
}
```

## 功能流程

1. **图片生成完成**：用户在结果页面看到生成的图片
2. **点击发布**：点击「发布到画廊」按钮
3. **获取用户信息**：调用 login 云函数获取用户 openid
4. **保存到数据库**：将图片信息保存到 images 集合
5. **发布成功**：显示成功提示并跳转到首页
6. **首页展示**：首页自动加载并展示公开的图片

## 权限配置

### 云数据库权限设置

在微信开发者工具中设置 `images` 集合权限：

```json
{
  "read": true,
  "write": "doc.openid == auth.openid"
}
```

这样设置可以确保：
- 所有用户都可以读取公开的图片
- 只有图片的创建者可以修改自己的图片记录

## 测试步骤

1. **生成图片**：在创作页面输入提示词生成图片
2. **发布测试**：在结果页面点击「发布到画廊」
3. **查看首页**：检查首页是否显示刚发布的图片
4. **权限测试**：确认其他用户可以看到但不能修改

## 注意事项

1. **网络环境**：确保小程序可以访问云数据库
2. **用户登录**：发布功能需要用户已登录（有 openid）
3. **图片URL**：确保图片URL有效且可访问
4. **数据库容量**：注意云数据库的存储限制

## 扩展功能

后续可以添加的功能：
- 图片点赞功能
- 图片评论功能
- 用户个人作品集
- 图片分类和标签
- 图片搜索功能