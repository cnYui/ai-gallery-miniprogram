# 微信小程序发布指南

## 📋 发布前准备清单

### 1. 开发者账号准备
- [ ] 注册微信小程序开发者账号
- [ ] 完成实名认证
- [ ] 获取小程序 AppID
- [ ] 配置服务器域名（如果使用云开发可跳过）

### 2. 项目配置检查
- [ ] 确认 `project.config.json` 中的 AppID 正确
- [ ] 检查云开发环境配置
- [ ] 验证所有功能正常运行
- [ ] 完成 TypeScript 编译检查

### 3. 代码质量检查
- [ ] 运行 `npx tsc --noEmit --skipLibCheck` 确保无类型错误
- [ ] 检查控制台无错误和警告
- [ ] 测试所有核心功能
- [ ] 验证图片保存、画廊发布等功能

## 🚀 发布流程

### 第一步：本地测试

1. **启动开发者工具**
   ```bash
   # 在项目根目录
   cd /Users/wujianxiang/WeChatProjects/miniprogram-3
   ```

2. **打开微信开发者工具**
   - 选择「导入项目」
   - 选择项目目录：`miniprogram-3`
   - 输入 AppID（如果没有可选择测试号）
   - 项目名称：AI 画廊小程序

3. **本地功能测试**
   - 测试文生图功能
   - 测试图片保存到相册
   - 测试画廊浏览和发布
   - 测试用户登录和个人中心
   - 测试主题切换功能

### 第二步：云开发部署

1. **部署云函数**
   ```bash
   # 在开发者工具中右键云函数目录
   # 选择「上传并部署：云端安装依赖」
   ```
   
   需要部署的云函数：
   - `login` - 用户登录
   - `text2image` - 文生图功能

2. **配置云数据库**
   - 创建 `users` 集合（用户信息）
   - 创建 `images` 集合（图片数据）
   - 按照优化建议创建索引：
     - `images` 集合：`_openid_1_createTime_-1`（组合索引）

3. **配置云存储**
   - 确保云存储权限配置正确
   - 测试图片上传和访问

### 第三步：版本管理

1. **设置版本号**
   - 在开发者工具中点击「上传」
   - 填写版本号（如：1.0.0）
   - 填写项目备注

2. **上传代码**
   - 确认代码包大小在限制内（< 2MB）
   - 检查是否包含敏感信息
   - 点击上传

### 第四步：提交审核

1. **登录小程序管理后台**
   - 访问：https://mp.weixin.qq.com
   - 使用管理员微信扫码登录

2. **配置基本信息**
   - **小程序名称**：AI 画廊
   - **小程序简介**：AI 智能绘画创作平台，支持文字生成图片、作品分享等功能
   - **服务类别**：工具 > 图片美化
   - **上传小程序头像**（建议 144x144px）

3. **提交审核**
   - 在「版本管理」中找到刚上传的版本
   - 点击「提交审核」
   - 填写审核信息：
     - **功能页面**：首页、创作页、画廊页、个人中心
     - **核心功能**：AI 文生图、图片保存、作品分享
     - **测试账号**：提供测试微信号（如需要）

## 📝 审核要点

### 1. 内容合规
- [ ] 确保生成的图片内容健康
- [ ] 添加内容审核机制
- [ ] 设置敏感词过滤

### 2. 功能完整性
- [ ] 所有功能正常可用
- [ ] 错误处理完善
- [ ] 用户体验良好

### 3. 隐私保护
- [ ] 用户授权流程规范
- [ ] 隐私政策完整
- [ ] 数据使用透明

## 🔧 常见问题解决

### 1. 审核被拒常见原因

**功能缺失**
- 解决方案：确保所有声明的功能都能正常使用

**内容违规**
- 解决方案：加强内容审核，过滤敏感内容

**用户体验问题**
- 解决方案：优化加载速度，完善错误提示

### 2. 技术问题

**云函数调用失败**
```javascript
// 检查云函数权限配置
wx.cloud.callFunction({
  name: 'text2image',
  data: { prompt: '测试' },
  success: console.log,
  fail: console.error
});
```

**图片保存失败**
```javascript
// 检查域名配置和权限
wx.downloadFile({
  url: 'https://your-domain.com/image.jpg',
  success: (res) => {
    wx.saveImageToPhotosAlbum({
      filePath: res.tempFilePath,
      success: () => console.log('保存成功'),
      fail: console.error
    });
  }
});
```

## 📊 发布后运营

### 1. 数据监控
- 用户访问量
- 功能使用率
- 错误日志分析
- 性能指标监控

### 2. 版本迭代
- 收集用户反馈
- 修复 bug
- 新功能开发
- 定期更新

### 3. 推广策略
- 朋友圈分享
- 微信群推广
- 内容营销
- 用户口碑传播

## 🎯 发布检查清单

### 发布前最终检查
- [ ] 所有功能测试通过
- [ ] 云开发环境配置正确
- [ ] 代码无错误和警告
- [ ] 用户体验流畅
- [ ] 内容合规检查
- [ ] 隐私政策完整
- [ ] 版本信息填写正确

### 审核提交信息
- [ ] 小程序基本信息完整
- [ ] 功能描述准确
- [ ] 测试路径清晰
- [ ] 审核说明详细

## 📞 技术支持

如果在发布过程中遇到问题，可以参考：

1. **微信官方文档**：https://developers.weixin.qq.com/miniprogram/dev/
2. **云开发文档**：https://developers.weixin.qq.com/miniprogram/dev/wxcloud/
3. **审核规范**：https://developers.weixin.qq.com/miniprogram/product/

## 🎉 发布成功后

恭喜！你的 AI 画廊小程序已经成功发布。记住：

- 持续关注用户反馈
- 定期更新和优化
- 监控性能和稳定性
- 遵守平台规范

祝你的小程序获得成功！🚀