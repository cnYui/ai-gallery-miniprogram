# 云开发部署说明

## 环境配置

云开发环境ID：`cloud1-6g4qsd2kcddd1be0`

## 部署步骤

### 1. 云函数部署

在微信开发者工具中：

1. 右键点击 `cloudfunctions/login` 文件夹
2. 选择「上传并部署：云端安装依赖（不上传node_modules）」
3. 等待部署完成

### 2. 云数据库配置

需要创建以下集合：

#### users 集合
存储用户信息
```json
{
  "_id": "自动生成",
  "_openid": "用户openid",
  "avatarUrl": "头像URL",
  "nickName": "用户昵称",
  "createTime": "创建时间",
  "updateTime": "更新时间"
}
```

#### user_images 集合
存储用户的AI生成作品

**字段结构：**
- `_id`: 系统自动生成的唯一标识
- `_openid`: 系统自动添加的用户标识
- `openid`: 用户的微信openid
- `imageUrl`: 生成的图片URL地址
- `prompt`: 正向提示词
- `negativePrompt`: 负向提示词（可选）
- `createTime`: 创建时间
- `isPublic`: 是否公开显示（布尔值）

```json
{
  "_id": "自动生成",
  "_openid": "用户openid",
  "imageUrl": "图片URL",
  "prompt": "创作提示词",
  "createTime": "创建时间"
}
```

### 3. 权限配置

在云开发控制台中，为数据库集合设置合适的权限：

- `users` 集合：仅创建者可读写
- `user_images` 集合：仅创建者可读写

### 4. 功能说明

- **用户登录**：使用微信授权登录，获取用户基本信息
- **用户注册**：首次登录时自动创建用户记录
- **数据同步**：用户信息和作品数据存储在云数据库中
- **退出登录**：清除本地登录状态

### 5. 注意事项

1. 确保小程序已开通云开发服务
2. 云开发环境ID需要与实际环境匹配
3. 需要在微信开发者工具中完成云函数和数据库的部署
4. 测试时需要使用真机或开发者工具的真实环境